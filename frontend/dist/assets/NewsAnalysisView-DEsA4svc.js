import{q as L,d as O,r,a as F,s as P,c as N,o as u,b as t,w as l,e as a,E as V,f as s,g as Q,h as f,n as x,t as i,k as p,m as W,_ as X}from"./index-B3MdEmXe.js";import{f as C,t as M}from"./display-CuAyYhFG.js";import{e as K}from"./errors-BvGLt0H_.js";async function Y(y){const{data:c}=await L.post("/news/analysis",y);return c}async function Z(){const{data:y}=await L.get("/news/history");return y}const ee={class:"news-page"},le={key:1,class:"analysis-result"},te={class:"analysis-result__meta"},ae={class:"dialog-header"},se={key:0,class:"dialog-body"},oe={class:"dialog-meta"},ne=O({__name:"NewsAnalysisView",setup(y){const c=r(),_=F({keyword:""}),v=r(!1),g=r(!1),m=r(null),k=r([]),w=r(!1),d=r(null),T=F({keyword:[{required:!0,message:"请输入关键词",trigger:"blur"}]});async function A(){if(c.value){try{await c.value.validate()}catch{return}v.value=!0;try{const n={keyword:_.keyword.trim()},e=await Y(n);m.value=e,_.keyword="",V.success(`已生成关于“${e.keyword}”的新闻分析`),await q()}catch(n){V.error(K(n))}finally{v.value=!1}}}function U(n){d.value=n,w.value=!0}function D(){w.value=!1,d.value=null}async function q(){g.value=!0;try{k.value=await Z()}catch(n){V.warning(K(n))}finally{g.value=!1}}return P(async()=>{await q()}),(n,e)=>{const $=a("el-input"),H=a("el-form-item"),h=a("el-button"),z=a("el-form"),I=a("el-divider"),R=a("el-empty"),S=a("el-scrollbar"),B=a("el-card"),E=a("el-col"),b=a("el-table-column"),j=a("el-table"),G=a("el-row"),J=a("el-dialog");return u(),N("div",ee,[t(G,{gutter:20},{default:l(()=>[t(E,{xs:24,lg:12},{default:l(()=>[t(B,{class:"form-card",shadow:"hover"},{header:l(()=>[...e[2]||(e[2]=[s("div",{class:"card-title"},"执行新闻分析",-1)])]),default:l(()=>[t(z,{ref_key:"newsFormRef",ref:c,model:_,rules:T,"label-position":"top",class:"analysis-form"},{default:l(()=>[t(H,{label:"关键词",prop:"keyword"},{default:l(()=>[t($,{modelValue:_.keyword,"onUpdate:modelValue":e[0]||(e[0]=o=>_.keyword=o),maxlength:"60",placeholder:"示例：人工智能",onKeyup:Q(A,["enter"])},null,8,["modelValue"])]),_:1}),t(H,null,{default:l(()=>[t(h,{type:"primary",loading:v.value,onClick:A},{default:l(()=>[...e[3]||(e[3]=[f("分析新闻",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"]),t(I),s("section",null,[e[4]||(e[4]=s("h3",{class:"section-title"},"最新分析结果",-1)),m.value?(u(),N("div",le,[s("p",te,[s("strong",null,i(m.value.keyword),1),s("span",null,i(p(C)(m.value.requestedAt)),1)]),t(S,{class:"analysis-result__scroll"},{default:l(()=>[s("pre",null,i(p(M)(m.value.analysis)),1)]),_:1})])):(u(),x(R,{key:0,description:"提交关键词后将显示分析结果"}))])]),_:1})]),_:1}),t(E,{xs:24,lg:12},{default:l(()=>[t(B,{class:"history-card",shadow:"hover"},{header:l(()=>[...e[5]||(e[5]=[s("div",{class:"card-title"},"近期新闻分析",-1)])]),default:l(()=>[k.value.length?(u(),x(j,{key:0,data:k.value,loading:g.value,border:"",height:"520"},{default:l(()=>[t(b,{prop:"keyword",label:"关键词",width:"200"}),t(b,{label:"生成时间",width:"200"},{default:l(o=>[f(i(p(C)(o.row.requestedAt)),1)]),_:1}),t(b,{label:"详情","min-width":"180",align:"center"},{default:l(o=>[t(h,{type:"primary",link:"",onClick:re=>U(o.row)},{default:l(()=>[...e[6]||(e[6]=[f("查看详情",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data","loading"])):(u(),x(R,{key:1,description:"暂无新闻历史"}))]),_:1})]),_:1})]),_:1}),t(J,{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=o=>w.value=o),width:"60%","show-close":!1,onClose:D},{header:l(()=>{var o;return[s("div",ae,[s("span",null,"新闻洞察："+i((o=d.value)==null?void 0:o.keyword),1),t(h,{text:"",type:"primary",onClick:D},{default:l(()=>[...e[7]||(e[7]=[f("关闭",-1)])]),_:1})])]}),default:l(()=>[d.value?(u(),N("div",se,[s("p",oe,i(p(C)(d.value.requestedAt)),1),s("pre",null,i(p(M)(d.value.analysis)),1)])):W("",!0)]),_:1},8,["modelValue"])])}}}),ce=X(ne,[["__scopeId","data-v-13e81cec"]]);export{ce as default};
